@page "/order"

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Cars - CSE Muscle Cars</title>
  <meta name="title" content="Order Cars - CSE Muscle Cars">
  <meta name="description" content="Browse and purchase premium muscle cars">

  <!-- 
    - favicon
  -->
  <link rel="shortcut icon" href="./favicon.png" type="image/png">

  <!-- 
    - remixicon
  -->
  <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css"
    rel="stylesheet"
/>

  <!-- 
    - google font link
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=Mulish&display=swap"
    rel="stylesheet">

  <!-- 
    - material icon font
  -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@40,600,0,0" />

  <!-- 
    - custom css link
  -->
  <link rel="stylesheet" href="css/site.css">

</head>

<body>

  @* <!-- 
    - #HEADER
  -->
  <header class="header">
    <nav class="nav container">
      <div class="nav__data">
        <a href="/" class="nav__logo">
          <img src="images/logo.png" width="128" height="63" alt="cse muscle cars home">
        </a>

        <div class="nav__toggle" id="nav-toggle">
          <i class="ri-menu-line nav__burger"></i>
          <i class="ri-close-line nav__close"></i>
        </div>
      </div>

      <!-- NAV MENU -->
      <nav class="nav__menu" id="nav-menu">
       <ul class="nav__list">
        <li><a href="/" class="nav__link">Home</a></li>
        <li><a href="/about" class="nav__link">About</a></li>
        <li class="dropdown__item">
          <div class="nav__link">
            Vehicles <i class="ri-arrow-down-s-line dropdown__arrow"></i>
          </div>

          <ul class="dropdown__menu">
            <li>
              <a href="/vehicles/chevrolet" class="dropdown__link">
                <i class="ri-car-line"></i> Chevrolet
              </a>
            </li>
            <li>
              <a href="/vehicles/ford" class="dropdown__link">
                <i class="ri-car-line"></i> Ford
              </a>
            </li>
            <li>
              <a href="/vehicles/dodge" class="dropdown__link">
                <i class="ri-car-line"></i> Dodge
              </a>
            </li>
          </ul>
        </li>
        <li><a href="/services" class="nav__link">Services</a></li>
        <li><a href="/contact" class="nav__link">Contact</a></li>
        <li><a href="/register" class="nav__link">Register</a></li>
        <li><a href="/login" class="nav__link">Login</a></li>
       </ul>
      </nav>
    </nav>
  </header> *@

  <main>
    <article>
      <!-- 
        - #ORDER SECTION
      -->
      <section class="section order" aria-labelledby="order-label">
        <div class="container">

          <p class="section-subtitle :light" id="order-label">Premium Collection</p>

          <h2 class="h2 section-title">Available Muscle Cars</h2>

          <div class="order-container" style="display: flex; gap: 2rem; align-items: flex-start;">
            
            <!-- Cars Grid -->
            <div class="cars-grid" style="flex: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
              @foreach (var car in availableCars)
              {
                    <div class="car-card" style="background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; transition: transform 0.3s ease;">
                      <div class="car-image" style="height: 200px; overflow: hidden;">
                        <img src="@car.ImageUrl" alt="@car.Model" loading="lazy" style="width: 100%; height: 100%; object-fit: cover;">
                      </div>
                  
                      <div class="car-content" style="padding: 1.5rem;">
                        <p class="car-make" style="color: #666; font-size: 0.9rem; margin: 0 0 0.5rem 0;">@car.Make</p>
                        <h3 class="car-title" style="font-size: 1.4rem; margin: 0 0 1rem 0; color: #333;">@car.Model</h3>
                    
                        <div class="car-details" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
                          <div class="car-detail" style="display: flex; justify-content: space-between;">
                            <span class="car-detail-label" style="font-weight: 500;">Year:</span>
                            <span class="car-detail-value">@car.Year</span>
                          </div>
                          <div class="car-detail" style="display: flex; justify-content: space-between;">
                            <span class="car-detail-label" style="font-weight: 500;">Color:</span>
                            <span class="car-detail-value">@car.Color</span>
                          </div>
                          <div class="car-detail" style="display: flex; justify-content: space-between;">
                            <span class="car-detail-label" style="font-weight: 500;">Engine:</span>
                            <span class="car-detail-value">@car.Engine</span>
                          </div>
                          <div class="car-detail" style="display: flex; justify-content: space-between;">
                            <span class="car-detail-label" style="font-weight: 500;">Mileage:</span>
                            <span class="car-detail-value">@car.Mileage miles</span>
                          </div>
                        </div>
                    
                        <div class="car-price" style="font-size: 1.8rem; font-weight: bold; color: #e74c3c; margin-bottom: 1rem;">$@car.Price.ToString("N0")</div>
                    
                        <p class="car-description" style="font-size: 0.9rem; color: #666; margin-bottom: 1.5rem; line-height: 1.4;">
                          @car.Description
                        </p>
                    
                        <button class="btn order-btn" @onclick="() => AddToCart(car)" style="width: 100%; background: #3498db; color: white; border: none; padding: 0.8rem; border-radius: 6px; font-weight: 500; cursor: pointer; transition: background 0.3s ease;">
                          <span class="span">Add to Cart</span>
                          <span class="material-symbols-rounded">shopping_cart</span>
                        </button>
                      </div>
                    </div>
              }
            </div>

            <!-- Cart Summary -->
            <div class="cart-summary" style="width: 300px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 1.5rem; position: sticky; top: 2rem;">
              <h3 class="cart-title" style="display: flex; align-items: center; gap: 0.5rem; margin: 0 0 1.5rem 0; font-size: 1.2rem;">
                <i class="ri-shopping-cart-line"></i>
                Shopping Cart
              </h3>
              
              @if (cartItems.Any())
              {
                    @foreach (var item in cartItems)
                    {
                          <div class="cart-item" style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0; border-bottom: 1px solid #eee;">
                            <span class="cart-item-name" style="font-size: 0.9rem; font-weight: 500;">@item.Car.Model</span>
                            <span class="cart-item-price" style="font-weight: bold; color: #e74c3c;">$@item.Car.Price.ToString("N0")</span>
                          </div>
                    }
                
                    <div class="cart-total" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; margin: 1rem 0; border-top: 2px solid #333; font-size: 1.1rem;">
                      <span class="cart-total-label" style="font-weight: bold;">Total</span>
                      <span class="cart-total-price" style="font-weight: bold; color: #e74c3c;">$@cartItems.Sum(x => x.Car.Price).ToString("N0")</span>
                    </div>
                
                    <button class="btn checkout-btn" @onclick="ProceedToCheckout" style="width: 100%; background: #27ae60; color: white; border: none; padding: 0.8rem; border-radius: 6px; font-weight: 500; cursor: pointer;">
                      <span class="span">Proceed to Checkout</span>
                      <span class="material-symbols-rounded">arrow_forward</span>
                    </button>
              }
              else
              {
                    <div class="empty-cart" style="text-align: center; padding: 2rem 0;">
                      <div class="empty-cart-icon" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;">
                        <i class="ri-shopping-cart-line"></i>
                      </div>
                      <p class="empty-cart-text" style="font-weight: 500; margin-bottom: 0.5rem;">Your cart is empty</p>
                      <p style="font-size: 0.9rem; color: #666;">Add some muscle cars to get started!</p>
                    </div>
              }
            </div>

          </div>

        </div>
      </section>

    </article>
  </main>

  <script>
    // Navigation toggle functionality
    const navToggle = document.getElementById('nav-toggle');
    const navMenu = document.getElementById('nav-menu');

    navToggle?.addEventListener('click', () => {
      navMenu.classList.toggle('show-menu');
      navToggle.classList.toggle('show-icon');
    });
  </script>

</body>

</html>

@code {
    private List<Car> availableCars = new();
    private List<CartItem> cartItems = new();
    private bool isLoggedIn = false; // This should be checked from authentication service

    protected override void OnInitialized()
    {
        LoadAvailableCars();
    }

    private void LoadAvailableCars()
    {
        // Sample data - in real app this would come from database
        availableCars = new List<Car>
        {
            new Car
            {
                Id = 1,
                Make = "Chevrolet",
                Model = "2024 Camaro SS",
                Year = 2024,
                Color = "White",
                Engine = "6.2L V8",
                Mileage = 2500,
                Price = 45000,
                Description = "Experience the thrill of raw power with the 2024 Camaro SS. This beast delivers 455 horsepower and features the latest technology while maintaining the classic muscle car appeal.",
                ImageUrl = "images/2024-camaro-9v2.jpg"
            },
            new Car
            {
                Id = 2,
                Make = "Chevrolet",
                Model = "2024 Corvette Stingray",
                Year = 2024,
                Color = "Blue",
                Engine = "6.2L V8",
                Mileage = 1800,
                Price = 62000,
                Description = "The iconic Corvette Stingray combines breathtaking performance with stunning design. With 495 horsepower and mid-engine layout, it's the pinnacle of American sports cars.",
                ImageUrl = "images/2024-stingray.jpg"
            },
            new Car
            {
                Id = 3,
                Make = "Ford",
                Model = "2024 Mustang GT",
                Year = 2024,
                Color = "Blue",
                Engine = "5.0L V8",
                Mileage = 3200,
                Price = 42000,
                Description = "The legendary Mustang GT continues to define American muscle. With 450 horsepower and a refined interior, it's the perfect blend of power and comfort.",
                ImageUrl = "images/2024-mustang.jpg"
            },
            new Car
            {
                Id = 4,
                Make = "Dodge",
                Model = "2024 Challenger SRT Hellcat",
                Year = 2024,
                Color = "White",
                Engine = "6.2L Supercharged V8",
                Mileage = 1500,
                Price = 68000,
                Description = "Unleash the beast within. The Challenger Hellcat delivers an earth-shaking 717 horsepower, making it one of the most powerful production cars ever built.",
                ImageUrl = "images/2024-camaro-9v2.jpg"
            },
            new Car
            {
                Id = 5,
                Make = "Ford",
                Model = "2024 Mustang Shelby GT500",
                Year = 2024,
                Color = "Grabber Blue",
                Engine = "5.2L Supercharged V8",
                Mileage = 800,
                Price = 75000,
                Description = "The ultimate Mustang. The Shelby GT500 produces 760 horsepower and features track-tuned suspension for the ultimate driving experience.",
                ImageUrl = "images/2024-mustang.jpg"
            },
            new Car
            {
                Id = 6,
                Make = "Dodge",
                Model = "2024 Charger Scat Pack",
                Year = 2024,
                Color = "Blue",
                Engine = "6.4L V8",
                Mileage = 2200,
                Price = 48000,
                Description = "Four doors, unlimited thrills. The Charger Scat Pack delivers 485 horsepower in a practical sedan package that doesn't compromise on performance.",
                ImageUrl = "images/2024-stingray.jpg"
            }
        };
    }

    private void AddToCart(Car car)
    {
        if (!isLoggedIn)
        {
            // In a real app, redirect to login or show login modal
            // For now, we'll just show a message
            return;
        }

        var existingItem = cartItems.FirstOrDefault(x => x.Car.Id == car.Id);
        if (existingItem != null)
        {
            // Car already in cart, could increment quantity or show message
            return;
        }

        cartItems.Add(new CartItem { Car = car, Quantity = 1 });
        StateHasChanged();
    }

    private void RemoveFromCart(Car car)
    {
        var item = cartItems.FirstOrDefault(x => x.Car.Id == car.Id);
        if (item != null)
        {
            cartItems.Remove(item);
            StateHasChanged();
        }
    }

    private void ProceedToCheckout()
    {
        if (!isLoggedIn)
        {
            // Redirect to login
            return;
        }

        // In a real app, this would redirect to checkout page or open checkout modal
        // For now, we'll just show a success message
    }

    public class Car
    {
        public int Id { get; set; }
        public string Make { get; set; } = string.Empty;
        public string Model { get; set; } = string.Empty;
        public int Year { get; set; }
        public string Color { get; set; } = string.Empty;
        public string Engine { get; set; } = string.Empty;
        public int Mileage { get; set; }
        public decimal Price { get; set; }
        public string Description { get; set; } = string.Empty;
        public string ImageUrl { get; set; } = string.Empty;
    }

    public class CartItem
    {
        public Car Car { get; set; } = new();
        public int Quantity { get; set; }
    }
}
